<html>
<head>
	<title>Townforge | Map</title>
	<link rel="stylesheet" href="./dist/leaflet.css"/>
<!-- Make sure you put this AFTER Leaflet's CSS -->
	<script src="./dist/leaflet.js"></script>

<!-- https://github.com/ablakey/Leaflet.SimpleGraticule --> 
	<link rel="stylesheet" href="./dist/L.SimpleGraticule.css" />
	<script src="./dist/L.SimpleGraticule.js"></script>
<!-- https://github.com/ablakey/Leaflet.SimpleGraticule --> 

<!-- https://github.com/BenPortner/leaflet-burgermenu --> 
	<link rel="stylesheet" href="./dist/leaflet-burgermenu.css"/>
	<script src="./dist/leaflet-burgermenu.umd.min.js"></script>
<!-- https://github.com/BenPortner/leaflet-burgermenu -->

<!-- Autocomplete on forms --> 
	<link rel="stylesheet" href="./dist/my-autocomplete.css"/>
	<script src="./dist/my-autocomplete.js"></script>
<!-- Autocomplete on forms --> 
<style>
#map {
	height: 100%;
	width:  100%;
	background: none;
	}
.popup_table {
	white-space: nowrap;
	}
/*<!-- .popup_without_tip .leaflet-popup-tip   first value add/edit second already defined value--> */
.popup_without_tip .leaflet-popup-tip {
	display: none;
	}
.leaflet-popup-content {
	width:auto !important;
	}
/*<!-- info box top right--> */
.info { padding: 6px 8px; font: 14px/16px Arial, Helvetica, sans-serif; background: white; background: rgba(255,255,255,0.8); box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 5px; } 
.info h4 { margin: 0 0 5px; color: #777; }
/*<!-- info box top right-->*/
.Legend_text_background_repair {
	line-height: 22px;
	width: 45px;
	border-radius: 15%;
	white-space: nowrap;
	text-align: center;
	}
.Legend_text_background_role {
	line-height: 22px;
	width: 115px;
	border-radius: 15%;
	white-space: nowrap;
	text-align: center;
	}
.Legend_text_background_Economic_Power {
	line-height: 22px;
	width: 55px;
	border-radius: 15%;
	white-space: nowrap;
	text-align: center;
	}
.Legend_br_height {
	line-height: 0.2;
	}
/*<!-- Flag sizes -->*/
.Flag_size_x .Flag_size_y {
	font-size: 10px; /* also inside function*/
	font-weight: 1;
	color: black;
	}
.Flag_size_x {
	writing-mode: horizontal-tb;
	}
.Flag_size_y {
	writing-mode: vertical-rl;
	}
/*<!-- Flag sizes -->*/
/*<!-- Pulsing Marker -->*/
.css-icon {
	}
.gps_ring {
	border: 3px solid #999;
	-webkit-border-radius: 30px;
	height: 18px;
	width: 18px;
	-webkit-animation: pulsate 1s ease-out;
	-webkit-animation-iteration-count: infinite; 
	/*opacity: 0.0*/
	}
@-webkit-keyframes pulsate {
	0% {-webkit-transform: scale(0.1, 0.1); opacity: 0.0;}
	50% {opacity: 1.0;}
	100% {-webkit-transform: scale(1.2, 1.2); opacity: 0.0;}
	}
/*<!-- Pulsing Marker -->*/
#HomeButton{
	display: flex;
	align-items: center;
	position: absolute;
	bottom: 27px;
	left: 45px;
	width: 32px;
	height: 32px;
	background-color: white;
	border-radius: 5px;
	border-color: gray;
	border-style: solid;
	border-width: 1px 1px 1px 1px;
	opacity: 0.8;
	text-align: center;
	z-index: 1000;
	justify-content: center;
	align-items: center;
	}
#HomeButton:hover{
	opacity: 1;
	cursor: pointer;
	}
#Calculate_influence_button{
	display: flex;
	align-items: center;
	position: absolute;
	bottom: 27px;
	left: 80px;
	width: 70px;
	height: 32px;
	background-color: white;
	border-radius: 5px;
	border-color: gray;
	border-style: solid;
	border-width: 1px;
	opacity: 0.8;
	text-align: center;
	z-index: 1000;
	justify-content: center;
	align-items: center;
	}
#Calculate_influence_button:hover{
	opacity: 1;
	cursor: pointer;
	}
#Disable_Highlight_Button{
	display: none;
	align-items: center;
	position: absolute;
	top: 5%;
	left: 50%;
	width: 200px;
	height: 50px;
	background-color: Lime;
	border-radius: 5px;
	border-color: Green;
	border-style: solid;
	border-width: 2px;
	opacity: 0.8;
	text-align: center;
	z-index: 1000;
	justify-content: center;
	align-items: center;
	}
#Disable_Highlight_Button:hover{
	opacity: 1;
	cursor: pointer;
	}
tr:nth-child(even) {
	/*Use an rgba() color to specify the transparency of the color:*/
	background-color: rgba(117, 117, 117, 0.1);
	}
</style>
</head>

<body>
<div id="map">
	<button id="HomeButton" title='Reset Map View' onclick='map.setView( [0, 0], -1);'>
		<img src="./dist/home.svg" style="width:20px;"></img>
		</button>
	<button id="Calculate_influence_button" title='Calculate Influence of Flags on Selection' style="line-height: 1;"
		onclick='
			if (map.hasLayer(featureGroup_Legend) == 0) {
				document.getElementById("Calculate_influence_button").style.background="Lime";
				document.getElementById("Calculate_influence_button").style.border="2px solid Green";
				featureGroup_Legend.addTo(map).clearLayers();
				legend_Influence_calculator.addTo(map);
				legend_role.remove();
				legend_repair.remove();
				legend_owner.remove();
				legend_EcoPow.remove();
				}
			else if (map.hasLayer(featureGroup_Legend) == 1) {
				document.getElementById("Calculate_influence_button").style.background="White";
				document.getElementById("Calculate_influence_button").style.border="1px solid Gray";
				featureGroup_Legend.remove();
				legend_Influence_calculator.remove();
				if (map.hasLayer(featureGroup_role) == 1) {legend_role.addTo(map)};
				if (map.hasLayer(featureGroup_repair) == 1) {legend_repair.addTo(map)};
				if (map.hasLayer(featureGroup_owner) == 1) {legend_owner.addTo(map)};
				if (map.hasLayer(featureGroup_EcoPow) == 1) {legend_EcoPow.addTo(map)};
				}
			'>
		Influence Calculator 
		</button>
	<button id="Disable_Highlight_Button" title='Disable Highlighted Flags' onclick='Show_only_account_id = 0;Reset_style_of_Geojson_Flags_Layers();document.getElementById("Disable_Highlight_Button").style.display = "none";'>
		Disable Highlighting Flags
		</button>
	</div>
<script type="text/javascript" src="GeoJSON_Flags_data.js"></script>
<script type="text/javascript" src="Account_data.js"></script>
<script>
function getColor_role(FlagRole) {
	return  FlagRole == 0  ? "white"  :
			FlagRole == 1  ? "LawnGreen"  :
			FlagRole == 2  ? "Cyan"  :
			FlagRole == 3  ? "SaddleBrown"  :
			FlagRole == 4  ? "Magenta"  :
			FlagRole == 5  ? "Orange"  :
			FlagRole == 6  ? "DarkOrange"  :
			FlagRole == 7  ? "OrangeRed"  :
			FlagRole == 8  ? "DarkSlateGray"  :
			FlagRole == 9  ? "MediumSlateBlue"  :
			FlagRole == 10 ? "Silver" :
			FlagRole == 11 ? "ForestGreen" :
			FlagRole == 12 ? "SandyBrown" :
			FlagRole == 13 ? "Tan" :
			FlagRole == 14 ? "NavajoWhite" :
			FlagRole == 15 ? "DimGray" :
			FlagRole == 16 ? "RebeccaPurple" :
			FlagRole == 17 ? "RoyalBlue" : "white" ;
	}

function getColor_active(FlagActive) {
	return  FlagActive == "true"  ? "Green"	:
			FlagActive == "false" ? "Red"	: "white" ;
	}
                        
function getColor_repair(FlagRepair) {
	return  FlagRepair > 70 ? "Chartreuse"		:
			FlagRepair > 60 ? "LightSalmon"		:
			FlagRepair > 50 ? "Coral"			:
			FlagRepair > 40 ? "Tomato"			:
			FlagRepair > 30 ? "OrangeRed"		:
			FlagRepair > 20 ? "MediumPurple" 	:
			FlagRepair >  0 ? "RebeccaPurple"	:
			FlagRepair == 0 ? "white"			: "white" ;
	}
                        
function getColor_owner(AccountHouseName) {
	let sum = 0;
	for (let i = 0; i < AccountHouseName.length; i++) {
		sum += AccountHouseName.charCodeAt(i);
		}
	const r = (sum * 7) % 256; // change number in "sum * 7" to get different color, it must be prime number 
	const g = (sum * 41) % 256; // prime numbers: 2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73, 79, 83, 89, 97
	const b = (sum * 67) % 256;
	return `#${[r, g, b]
	.map((x) => x.toString(16).padStart(2, '0'))
	.join('')}`;
	}

function getColor_Economic_Power(FlagEconomicPower) {
	return  FlagEconomicPower == 300 ? "#0AF51A"	:
			FlagEconomicPower >  250 ? "#23AC1F"	:
			FlagEconomicPower >  200 ? "#22681B"	:
			FlagEconomicPower >  150 ? "#F58F0A"	:
			FlagEconomicPower >  100 ? "#AD6614"	:
			FlagEconomicPower == 100 ? "#694014"	: "white" ;
	}

function Style_Role(feature) {
	let color = 'LightGray'
	if (Show_only_account_id == 0) {
		color = getColor_role(feature.properties.role)
		}
	else if (Show_only_account_id != 0 && Show_only_account_id == feature.properties.owner) {
		color = getColor_role(feature.properties.role)
		};
	return {
		weight: 1,
		opacity: 1,
		color: getColor_active(feature.properties.active),
		dashArray: '4',
		fillOpacity: 0.8,
		fillColor: color
		};
	}
	
function Style_Repair(feature) {
	let color = 'LightGray'
	if (Show_only_account_id == 0) {
		color = getColor_repair(feature.properties.repair)
		}
	else if (Show_only_account_id != 0 && Show_only_account_id == feature.properties.owner) {
		color = getColor_repair(feature.properties.repair)
		};
	return {
		weight: 1,
		opacity: 1,
		color: getColor_active(feature.properties.active),
		dashArray: '4',
		fillOpacity: 0.8,
		fillColor: color
		};
	}

function Style_Owner(feature) {
	let color = 'LightGray'
	if (Show_only_account_id == 0) {
		color = getColor_owner(ACCOUNT_HOUSE[feature.properties.owner])
		}
	else if (Show_only_account_id != 0 && Show_only_account_id == feature.properties.owner) {
		color = getColor_owner(ACCOUNT_HOUSE[feature.properties.owner])
		};
	return {
		weight: 1,
		opacity: 1,
		color: getColor_active(feature.properties.active),
		dashArray: '4',
		fillOpacity: 0.8,
		fillColor: color
		};
	}

function Style_Economic_Power(feature) {
	let color = 'LightGray'
	if (Show_only_account_id == 0) {
		color = getColor_Economic_Power(feature.properties.ep)
		}
	else if (Show_only_account_id != 0 && Show_only_account_id == feature.properties.owner) {
		color = getColor_Economic_Power(feature.properties.ep)
		};
	return {
		weight: 1,
		opacity: 1,
		color: getColor_active(feature.properties.active),
		dashArray: '4',
		fillOpacity: 0.8,
		fillColor: color
		};
	}

function function_highlightFeature(e) {
		const layer = e.target;

		layer.setStyle({
			weight: 7,
			dashArray: '',
			fillOpacity: 0.8
			});
		layer.bringToFront();
		info.update(layer.feature);
		
		if (Enabled_LayerOverlay_InfluenceMouseOver == true) {
			if (layer.feature.properties.role != 0) {
				const influence = Number(layer.feature.properties.inf)
				const coordinates = [
					[
						xy((layer.feature.geometry.coordinates[0][0][0]) - influence,(layer.feature.geometry.coordinates[0][0][1]) - influence),
						xy((layer.feature.geometry.coordinates[0][1][0]) + influence,(layer.feature.geometry.coordinates[0][1][1]) - influence),
						xy((layer.feature.geometry.coordinates[0][2][0]) + influence,(layer.feature.geometry.coordinates[0][2][1]) + influence),
						xy((layer.feature.geometry.coordinates[0][3][0]) - influence,(layer.feature.geometry.coordinates[0][3][1]) + influence),
					],
					[xy(layer.feature.geometry.coordinates[0][0]),xy(layer.feature.geometry.coordinates[0][1]),xy(layer.feature.geometry.coordinates[0][2]),xy(layer.feature.geometry.coordinates[0][3])]
					]
				Influence_Rectangle_MouseOver = L.polygon( coordinates, {weight: 0, fillColor: 'LimeGreen', fillOpacity: 0.4, interactive: false}).addTo(LayerOverlay_InfluenceMouseOver);
				}
			}
	}	
	
function function_resetHighlight(e) {
		const layer = e.target;

		layer.setStyle({
			weight: 1,
			dashArray: '4',
			fillOpacity: 0.8
			});
		layer.bringToBack();
		info.update();
		
		if (Enabled_LayerOverlay_InfluenceMouseOver == true) {
			Influence_Rectangle_MouseOver.removeFrom(LayerOverlay_InfluenceMouseOver)
			}
	}
  
function onEachFeature(feature, layer) {	
		layer.on({	
			mouseover: function_highlightFeature,	
			mouseout: function_resetHighlight,	
			});
		var popup_text=(`<table class='popup_table'><tr><td>Name:</td><td><b>${feature.properties.name}</b></td></tr><tr><td>Owner:</td><td>${ACCOUNT_NAME[feature.properties.owner]}</td></tr><tr><td>House:</td><td>${ACCOUNT_HOUSE[feature.properties.owner]}</td></tr><tr><td>Role:</td><td>${FLAG_ROLE_NAME[feature.properties.role]}</td></tr><tr><td>Active:</td><td>${feature.properties.active}</td></tr><tr><td>Flag ID:</td><td>${feature.id}</td></tr><tr><td>Size: </td><td>${feature.properties.size}</td></tr><tr><td>Economic Power: </td><td>${feature.properties.ep} %</td></tr><tr><td>Repair: </td><td>${feature.properties.repair} %</td></tr></table>`)
		layer.bindPopup(popup_text,{maxWidth: 1000,});
	}

function getFlagIDFromName(FlagName) {
	const allFlagsCities = [  Flags_city0, Flags_city1, Flags_city2, Flags_city3, Flags_city4,];
	for (const cityGeoJSON of allFlagsCities) {
		const feature = cityGeoJSON.features.find(f => f.properties.name === FlagName);
		if (feature) {
			const log_message000210 = FlagName
			const log_message000211 = ' : Name | ID : '
			const log_message000212 = feature.id
			log_message0002 = log_message000210 + log_message000211 + log_message000212
			console.log(log_message0002)
			return feature.id
			}
		}
	return null;
	}

function getFlagInfoFromID(FlagID) {
	const allFlagsCities = [  Flags_city0, Flags_city1, Flags_city2, Flags_city3, Flags_city4,];
	for (const cityGeoJSON of allFlagsCities) {
		const feature = cityGeoJSON.features.find(f => f.id === FlagID);
		if (feature) {
			let html =''
			html += '<table style="white-space: nowrap;width: 100%;"><tr><td>Name:</td><td><b>'
			html += feature.properties.name
			html += '</b></td></tr><tr><td>Owner:</td><td>'
			html += ACCOUNT_NAME[feature.properties.owner]
			html += '</b></td></tr><tr><td>House:</td><td>'
			html += ACCOUNT_HOUSE[feature.properties.owner]
			html += '</b></td></tr><tr><td>City:</td><td>'
			html += CITY_NAME[feature.properties.city]
			html += '</td></tr><tr><td>Role:</td><td>'
			html += FLAG_ROLE_NAME[feature.properties.role]
			html += '</td></tr><tr><td>Active:</td><td>'
			html += feature.properties.active
			html += '</td></tr><tr><td>Flag ID:</td><td>'
			html += feature.id
			html += '</td></tr><tr><td>Size: </td><td>'
			html += feature.properties.size
			html += '</td></tr><tr><td>Economic Power: </td><td>'
			html += feature.properties.ep
			html += ' %</td></tr><tr><td>Repair: </td><td>'
			html += feature.properties.repair
			html += ' %</td></tr></table>'
			return html;
			}
		}
	return null;
	}

function getAllFlagsForID(AccountID) {
	const allFlagsCities = [  Flags_city0, Flags_city1, Flags_city2, Flags_city3, Flags_city4,];
	const breakAfter = 20;
	let cityResults = [];
	allFlagsCities.forEach((cityGeoJSON, index) => {
		if (!cityGeoJSON || !cityGeoJSON.features) return;
		const filteredFeatures = cityGeoJSON.features.filter(feature =>
			feature.properties.owner == AccountID
		);
		if (filteredFeatures.length === 0) return;
		const sortedIDs = filteredFeatures
			.map(feature => Number(feature.id))
			.sort((a, b) => a - b);
		let formattedParts = [];
		for (let i = 0; i < sortedIDs.length; i += breakAfter) {
			const chunk = sortedIDs.slice(i, i + breakAfter);
			formattedParts.push(chunk.join(', '));
		}
		const formattedIDs = formattedParts.join('<br>');
		cityResults.push(`<tr><td colspan="2">&emsp;&emsp;&emsp;${CITY_NAME[index]}:</td></tr><tr><td></td><td>${formattedIDs}</td></tr>`);
		});
	if (cityResults.length === 0) {
		return null;
		}
	const finalResult = cityResults.join('');
	return finalResult;
	}
function Jump_to_Flag_from_ID(value) {
	const allFlagsCities = [  Flags_city0, Flags_city1, Flags_city2, Flags_city3, Flags_city4,];
	for (const cityGeoJSON of allFlagsCities) {
		// Use Array.prototype.find to locate the feature with the matching name property
		const feature = cityGeoJSON.features.find(f => f.id === value);
		if (feature) {
			var text = ""
			text += 'Jumped to Flag Id:' + value
			// If found, return the id, else return null or undefined
			const x = ( feature.geometry.coordinates[0][0][0] + ( ( feature.geometry.coordinates[0][2][0] - feature.geometry.coordinates[0][0][0] ) / 2 ));
			const y = ( feature.geometry.coordinates[0][0][1] + ( ( feature.geometry.coordinates[0][2][1] - feature.geometry.coordinates[0][0][1] ) / 2 ));
			const city = feature.properties.city
			BaseLayer_City0.removeFrom(map)
			BaseLayer_City1.removeFrom(map)
			BaseLayer_City2.removeFrom(map)
			BaseLayer_City3.removeFrom(map)
			BaseLayer_City4.removeFrom(map)
			if (city === '0') { BaseLayer_City0.addTo(map)}
			if (city === '1') { BaseLayer_City1.addTo(map)}
			if (city === '2') { BaseLayer_City2.addTo(map)}
			if (city === '3') { BaseLayer_City3.addTo(map)}
			if (city === '4') { BaseLayer_City4.addTo(map)}
			map.closePopup();
			map.removeLayer(SearchMarker);
			SearchMarker = new L.marker(xy([x, y])).on('click', function(e) { map.removeLayer(SearchMarker);});
			map.addLayer(SearchMarker);
			text1 = ""
			text1 += '<abbr style="white-space: nowrap;">Flag ID: ' + value + '</abbr>'
			SearchMarker.bindPopup(text1).openPopup();
			map.setView( xy([x, y]));
			return feature ? text : null;
			}
		}
	// If not found in any cities
	return null;
	}

function GoToFlag_Button_1() {
	var x = document.getElementById('search_form_1');
	var text001 = '';
	text001 += 'Go To Flag Id: ' + x.elements[0].value
	console.log(text001);
	const log_message0001 = Jump_to_Flag_from_ID(x.elements[0].value);
	console.log(log_message0001);
	}

function GoToFlag_Button_2() {
	var x = document.getElementById('search_form_2');
	var text001 = '';
	text001 += 'Go To Flag Name: ' + x.elements[0].value
	console.log(text001);
	const log_message0001 = Jump_to_Flag_from_ID(getFlagIDFromName(x.elements[0].value));
	console.log(log_message0001);
	}

function Search_Button_1() {                                 
	var x = document.getElementById('search_form_1');              
	var text = '<b>Results:</b>';                                                            
	text += getFlagInfoFromID(x.elements[0].value) + '<br>';
	document.getElementById("search_form_result1").innerHTML = text;
	document.getElementById("button01").disabled = false;
	console.log(x.elements[0].value);                                                     
	}

function Search_Button_2() {                                 
	var x = document.getElementById('search_form_2');
	console.log(x.elements[0].value);
	var text = '<b>Results:</b>';                                                            
	text += getFlagInfoFromID(getFlagIDFromName(x.elements[0].value)) + '<br>';
	document.getElementById("search_form_result2").innerHTML = text;
	document.getElementById("button02").disabled = false;
	}

function Search_Button_3() {
	let x = document.getElementById('search_form_3');
	let text = '<b>Results:</b>'
	text += '<table style="white-space: nowrap;"><tr>'
	text += '<td>House:</td>'
	text += '<td>' + ACCOUNT_HOUSE[ACCOUNT_NAME.indexOf(x.elements[0].value)] + '</td></tr>'
	text += '<tr><td>Current Descendant:</td>'
	text += '<td>' + ACCOUNT_NAME[ACCOUNT_NAME.indexOf(x.elements[0].value)] + '</td></tr>'
	text += '<tr><td>Account ID:</td>'
	text += '<td>' + ACCOUNT_NAME.indexOf(x.elements[0].value) + '</td></tr>'
	text += '<tr><td colspan="2">Owned Flags:</td></tr>';
	text += getAllFlagsForID(ACCOUNT_NAME.indexOf(x.elements[0].value));
	text += '</table>'
	document.getElementById("search_form_result3").innerHTML = text;
	console.log(x.elements[0].value);
	document.getElementById("button03").disabled = false;
	}

function Search_Button_4() {
	let x = document.getElementById('search_form_4');
	let text = '<b>Results:</b>'
	text += '<table style="white-space: nowrap;"><tr>'
	text += '<td>House:</td>'
	text += '<td>' + ACCOUNT_HOUSE[ACCOUNT_HOUSE.indexOf(x.elements[0].value)] + '</td></tr>'
	text += '<tr><td>Current Descendant:</td>'
	text += '<td>' + ACCOUNT_NAME[ACCOUNT_HOUSE.indexOf(x.elements[0].value)] + '</td></tr>'
	text += '<tr><td>Account ID:</td>'
	text += '<td>' + ACCOUNT_HOUSE.indexOf(x.elements[0].value) + '</td></tr>'
	text += '<tr><td colspan="2">Owned Flags:</td></tr>';
	text += getAllFlagsForID(ACCOUNT_HOUSE.indexOf(x.elements[0].value));
	text += '</table>'
	document.getElementById("search_form_result4").innerHTML = text;
	console.log(x.elements[0].value);
	document.getElementById("button04").disabled = false;
	}

function Show_only_account_id_3() {
	Show_only_account_id = ACCOUNT_NAME.indexOf(document.getElementById('search_form_3').elements[0].value);
	Reset_style_of_Geojson_Flags_Layers();
	document.getElementById("Disable_Highlight_Button").style.display = "flex";
	document.getElementById("button03").disabled = true;
	}

function Show_only_account_id_4() {
	Show_only_account_id = ACCOUNT_HOUSE.indexOf(document.getElementById('search_form_4').elements[0].value);
	Reset_style_of_Geojson_Flags_Layers();
	document.getElementById("Disable_Highlight_Button").style.display = "flex";
	document.getElementById("button04").disabled = true;
	}

function Reset_style_of_Geojson_Flags_Layers() {
	Layer_Flags_ColorByRole_City0.resetStyle()
	Layer_Flags_ColorByRepair_City0.resetStyle()
	Layer_Flags_ColorByOwner_City0.resetStyle()
	Layer_Flags_ColorByEcoPow_City0.resetStyle()
	Layer_Flags_ColorByRole_City1.resetStyle()
	Layer_Flags_ColorByRepair_City1.resetStyle()
	Layer_Flags_ColorByOwner_City1.resetStyle()
	Layer_Flags_ColorByEcoPow_City1.resetStyle()
	Layer_Flags_ColorByRole_City2.resetStyle()
	Layer_Flags_ColorByRepair_City2.resetStyle()
	Layer_Flags_ColorByOwner_City2.resetStyle()
	Layer_Flags_ColorByEcoPow_City2.resetStyle()
	Layer_Flags_ColorByRole_City3.resetStyle()
	Layer_Flags_ColorByRepair_City3.resetStyle()
	Layer_Flags_ColorByOwner_City3.resetStyle()
	Layer_Flags_ColorByEcoPow_City3.resetStyle()
	Layer_Flags_ColorByRole_City4.resetStyle()
	Layer_Flags_ColorByRepair_City4.resetStyle()
	Layer_Flags_ColorByOwner_City4.resetStyle()
	Layer_Flags_ColorByEcoPow_City4.resetStyle()
	}

function runAutocomplete_flag_id() {
	autocomplete(document.getElementById("myInput1"), autocomplete_all_flag_ids);
	}

function runAutocomplete_flag_names() {
	autocomplete(document.getElementById("myInput2"), autocomplete_all_flag_names);
	}

function runAutocomplete_account_names() {
	autocomplete(document.getElementById("myInput3"), ACCOUNT_NAME);
	}

function runAutocomplete_house_names() {
	autocomplete(document.getElementById("myInput4"), ACCOUNT_HOUSE);
	}
function generateTable(ArrayWithData, IndexInSubArray) {
	const entries = Object.entries(ArrayWithData).filter(([key, value]) => !isNaN(key) && Array.isArray(value));
	entries.sort((a,b) => Number(b[1][IndexInSubArray]) - Number(a[1][IndexInSubArray]));
	let html = `<table class='popup_table'>`;
	html += `<thead><tr><th colspan="3"><h2>${Account_data_fieldNames[IndexInSubArray]} Leaderboard</h2></th></tr></thead><tbody>`;
	html += `<thead><tr><td><u><b>House</b></u></td><td><u><b>Name</b></u></td><td><u><b>${Account_data_fieldNames[IndexInSubArray]}</b></u></td></tr></thead><tbody>`;
	for (const [index, accountArray] of entries) {
		html += `<tr><td>${ACCOUNT_HOUSE[index]}</td><td>${ACCOUNT_NAME[index]}</td><td align="right">${formatNumberWithDots(accountArray[IndexInSubArray])}</td></tr>`;
		}
	html += `</tbody></table>`;
	return html;
	}

function formatNumberWithDots(NumberWithoutDots) {
	return NumberWithoutDots.replace(/\B(?=(\d{3})+(?!\d))/g, ".");
	}

function parseDate(StringWithGeneratedTime) {
	const [date, time] = StringWithGeneratedTime.split('_');
	const [year, month, day] = date.split('/').map(Number);
	const [hour, minute] = time.split(':').map(Number);
	return new Date(Date.UTC(year, month - 1, day, hour, minute));
	}
  
function update_tick_timer() {
	const now = new Date();
	let diff = target - now; // ms difference
	diff = Math.abs(diff);
	const totalSeconds = Math.floor(diff / 1000);
	const hours = Math.floor(totalSeconds / 3600);
	const minutes = Math.floor((totalSeconds % 3600) / 60);
	const seconds = totalSeconds % 60;
	timerEl.textContent =`Last update ${hours}h ${minutes}m ${seconds}s ago`;
	}

function function_select_first_marker(e) {
	L.DomEvent.addListener(map, 'click', this.function_select_first_marker_enterAddMarkerMode.bind(this));
	}

function function_select_first_marker_enterAddMarkerMode () {
	Select_Ignore_interactive_map_Rectangle.addTo(map);
	document.getElementById("InfluenceButton1").style.background="Lime";
	document.getElementById("InfluenceButton1").style.border="1px solid Green";
	document.getElementById("InfluenceButton1").disabled = true;
	document.getElementById("InfluenceButton2").disabled = true;
	document.getElementById("InfluenceButton3").disabled = true;
	//this.map._container.style.cursor = 'crosshair';
	this.map.addEventListener('click', this.function_select_first_marker_onMapClickAddMarker.bind(this));
	}

function function_select_first_marker_onMapClickAddMarker (e) {
	"use strict";
	Select_Ignore_interactive_map_Rectangle.remove();
	document.getElementById("InfluenceButton1").style.background="";
	document.getElementById("InfluenceButton1").style.border="";
	document.getElementById("InfluenceButton1").disabled = false;
	document.getElementById("InfluenceButton2").disabled = false;
	document.getElementById("InfluenceButton3").disabled = false;
	this.map.removeEventListener('click');
	//this.map._container.style.cursor = 'auto';
	marker_first.remove()
	marker_first = L.marker(e.latlng, {draggable: true})
	marker_first.addTo(featureGroup_Legend);
	}

function function_select_second_marker(e) {
	L.DomEvent.addListener(map, 'click', this.function_select_second_marker_enterAddMarkerMode.bind(this));
	}

function function_select_second_marker_enterAddMarkerMode () {
	Select_Ignore_interactive_map_Rectangle.addTo(map);
	document.getElementById("InfluenceButton2").style.background="Lime";
	document.getElementById("InfluenceButton2").style.border="1px solid Green";
	document.getElementById("InfluenceButton1").disabled = true;
	document.getElementById("InfluenceButton2").disabled = true;
	document.getElementById("InfluenceButton3").disabled = true;
	//this.map._container.style.cursor = 'crosshair';
	this.map.addEventListener('click', this.function_select_second_marker_onMapClickAddMarker.bind(this));
	}

function function_select_second_marker_onMapClickAddMarker (e) {
	"use strict";
	Select_Ignore_interactive_map_Rectangle.remove();
	document.getElementById("InfluenceButton2").style.background="";
	document.getElementById("InfluenceButton2").style.border="";
	document.getElementById("InfluenceButton1").disabled = false;
	document.getElementById("InfluenceButton2").disabled = false;
	document.getElementById("InfluenceButton3").disabled = false;
	this.map.removeEventListener('click');
	//this.map._container.style.cursor = 'auto';
	marker_second.remove()
	marker_second = L.marker(e.latlng, {draggable: true})
	marker_second.addTo(featureGroup_Legend);
	}

function function_get_selection_influence () {
	let Selection_x0 = 0
	let Selection_y0 = 0
	let Selection_x1 = 0 
	let Selection_y1 = 0
	let Selection_city = 0
	let Selection_is_empty = 'yes'
	let Influence_from_role_percent = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
	let influencing = 0
	Selection_x0 = Math.min(marker_first.getLatLng().lng, marker_second.getLatLng().lng)// Longitude
	Selection_y0 = Math.min(marker_first.getLatLng().lat, marker_second.getLatLng().lat)// Latitude
	Selection_x1 = Math.max(marker_first.getLatLng().lng, marker_second.getLatLng().lng) // Longitude
	Selection_y1 = Math.max(marker_first.getLatLng().lat, marker_second.getLatLng().lat)// Latitude
	//console.log(Selection_x0)
	//console.log(Selection_y0)
	//console.log(Selection_x1)
	//console.log(Selection_y1)
	if (map.hasLayer(BaseLayer_City0) == 1) { Selection_city = 0 }
	if (map.hasLayer(BaseLayer_City1) == 1) { Selection_city = 1 }
	if (map.hasLayer(BaseLayer_City2) == 1) { Selection_city = 2 }
	if (map.hasLayer(BaseLayer_City3) == 1) { Selection_city = 3 }
	if (map.hasLayer(BaseLayer_City4) == 1) { Selection_city = 4 }
	const temp1 = marker_first.getLatLng()
	const temp2 = marker_second.getLatLng()
	featureGroup_Legend.clearLayers();
	marker_first = L.marker(temp1, {draggable: true}).addTo(featureGroup_Legend);
	marker_second = L.marker(temp2, {draggable: true}).addTo(featureGroup_Legend);
	rectangle_from_markers = L.rectangle([xy([Selection_x0, Selection_y0]),xy([Selection_x1, Selection_y1])], {color: 'Blue',fillColor: 'SkyBlue', weight: 3, fillOpacity: 0.9, interactive: false}).addTo(featureGroup_Legend);
	var run = L.geoJson(allFlagsCities, {
		onEachFeature: function(feature, layer){
			let uz_je_tam_flag = 0
			let Selection_Flag_pres_sebe_msq = 0
			let OtherFlag_x0 = feature.geometry.coordinates[0][0][0]
			let OtherFlag_y0 = feature.geometry.coordinates[0][0][1]
			let OtherFlag_x1 = feature.geometry.coordinates[0][2][0]
			let OtherFlag_y1 = feature.geometry.coordinates[0][2][1]
			if ( Selection_city == feature.properties.city ) {
				let Dx0
				let Dy0
				let Dx1
				let Dy1
				if (Math.max(Selection_x0, OtherFlag_x0) < Selection_x1) { Dx0 = Math.max(Selection_x0, OtherFlag_x0); uz_je_tam_flag += 1 }
				if (Math.max(Selection_y0, OtherFlag_y0) < Selection_y1) { Dy0 = Math.max(Selection_y0, OtherFlag_y0); uz_je_tam_flag += 1 }
				if (Math.min(Selection_x1, OtherFlag_x1) > Selection_x0) { Dx1 = Math.min(Selection_x1, OtherFlag_x1); uz_je_tam_flag += 1 }
				if (Math.min(Selection_y1, OtherFlag_y1) > Selection_y0) { Dy1 = Math.min(Selection_y1, OtherFlag_y1); uz_je_tam_flag += 1 }
				if ( uz_je_tam_flag == 4 ) {
					Selection_Flag_pres_sebe_msq = (Dx1 - Dx0) * (Dy1 - Dy0)
					Selection_is_empty = 'no'
				}
			}

			let influence_pres_selection = 0
			if ( Selection_city == feature.properties.city ) {
				OtherFlag_x0 -= Number(feature.properties.inf)
				OtherFlag_y0 -= Number(feature.properties.inf)
				OtherFlag_x1 += Number(feature.properties.inf)
				OtherFlag_y1 += Number(feature.properties.inf)
				if (Math.max(Selection_x0, OtherFlag_x0) < Selection_x1) { Dx0 = Math.max(Selection_x0, OtherFlag_x0); influence_pres_selection += 1 }
				if (Math.max(Selection_y0, OtherFlag_y0) < Selection_y1) { Dy0 = Math.max(Selection_y0, OtherFlag_y0); influence_pres_selection += 1 }
				if (Math.min(Selection_x1, OtherFlag_x1) > Selection_x0) { Dx1 = Math.min(Selection_x1, OtherFlag_x1); influence_pres_selection += 1 }
				if (Math.min(Selection_y1, OtherFlag_y1) > Selection_y0) { Dy1 = Math.min(Selection_y1, OtherFlag_y1); influence_pres_selection += 1 }
				const Selection_msq = (Selection_x1 - Selection_x0) * (Selection_y1 - Selection_y0)
				const Influence_msq = (OtherFlag_x1 - OtherFlag_x0)*(OtherFlag_y1 - OtherFlag_y0)

				let Dsqm
				if ( influence_pres_selection == 4 ){
				Dsqm = (Dx1 - Dx0) * (Dy1 - Dy0)
				}
				let showlog = 0
				if ( Dsqm > 0 ) { //overlap
				influencing += 1
				Influence_from_role_percent[feature.properties.role] += ( Dsqm / Selection_msq * 100 ) // influence in percent
				}
			}
		}
		})

	let text001 = (Selection_x1 - Selection_x0)
	let text002 = (Selection_y1 - Selection_y0)
	let text = `${text001} x ${text002}`
	let WARNING = ""
	if (text001 > 256 && text002 < 256){
		WARNING = "<h1 style='color:red'>Selected x is larger than 256</h1>"
		}
	if (text001 < 256 && text002 > 256){
		WARNING = "<h1 style='color:red'>Selected y is larger than 256</h1>"
		}
	if (text001 > 256 && text002 > 256){
		WARNING = "<h1 style='color:red'>Selected x and y is larger than 256</h1>"
		}
	let WARNING2 = ""
	if (Selection_is_empty == 'no'){
		WARNING2 = "<h1 style='color:red'>Flag is already there</h1>"
		}
	text1=`
<table class='popup_table'><thead>${WARNING}${WARNING2}</thead><tbody>
<tr><td>Selection</td><td>${text}</td></tr>
<tr><td colspan="2"><b>Influence from role</b></td></tr>
<tr><td>${FLAG_ROLE_NAME[1]}</td><td>${Math.trunc((Math.trunc(Influence_from_role_percent[1])+50)/100)}</td></tr>
<tr><td>${FLAG_ROLE_NAME[2]}</td><td>${Math.trunc((Math.trunc(Influence_from_role_percent[2])+50)/100)}</td></tr>
<tr><td>${FLAG_ROLE_NAME[3]}</td><td>${Math.trunc((Math.trunc(Influence_from_role_percent[3])+50)/100)}</td></tr>
<tr><td>${FLAG_ROLE_NAME[4]}</td><td>${Math.trunc((Math.trunc(Influence_from_role_percent[4])+50)/100)}</td></tr>
<tr><td>${FLAG_ROLE_NAME[5]}</td><td>${Math.trunc((Math.trunc(Influence_from_role_percent[5])+50)/100)}</td></tr>
<tr><td>${FLAG_ROLE_NAME[6]}</td><td>${Math.trunc((Math.trunc(Influence_from_role_percent[6])+50)/100)}</td></tr>
<tr><td>${FLAG_ROLE_NAME[7]}</td><td>${Math.trunc((Math.trunc(Influence_from_role_percent[7])+50)/100)}</td></tr>
<tr><td>${FLAG_ROLE_NAME[8]}</td><td>${Math.trunc((Math.trunc(Influence_from_role_percent[8])+50)/100)}</td></tr>
<tr><td>${FLAG_ROLE_NAME[9]}</td><td>${Math.trunc((Math.trunc(Influence_from_role_percent[9])+50)/100)}</td></tr>
<tr><td>${FLAG_ROLE_NAME[10]}</td><td>${Math.trunc((Math.trunc(Influence_from_role_percent[10])+50)/100)}</td></tr>
<tr><td>${FLAG_ROLE_NAME[11]}</td><td>${Math.trunc((Math.trunc(Influence_from_role_percent[11])+50)/100)}</td></tr>
<tr><td>${FLAG_ROLE_NAME[12]}</td><td>${Math.trunc((Math.trunc(Influence_from_role_percent[12])+50)/100)}</td></tr>
<tr><td>${FLAG_ROLE_NAME[13]}</td><td>${Math.trunc((Math.trunc(Influence_from_role_percent[13])+50)/100)}</td></tr>
<tr><td>${FLAG_ROLE_NAME[14]}</td><td>${Math.trunc((Math.trunc(Influence_from_role_percent[14])+50)/100)}</td></tr>
<tr><td>${FLAG_ROLE_NAME[15]}</td><td>${Math.trunc((Math.trunc(Influence_from_role_percent[15])+50)/100)}</td></tr>
<tr><td>${FLAG_ROLE_NAME[16]}</td><td>${Math.trunc((Math.trunc(Influence_from_role_percent[16])+50)/100)}</td></tr>
<tr><td>${FLAG_ROLE_NAME[17]}</td><td>${Math.trunc((Math.trunc(Influence_from_role_percent[17])+50)/100)}</td></tr>
<tr><td colspan="3"><a target="_blank" href="https://townforge.net/manual/">townforge.net/manual/</a>  Influence</td></tr>
</tbody>
</table>
`;
	var popup = L.popup({maxWidth: 1000, className: 'popup_without_tip', autoClose: true, closeOnClick: false})
			.setLatLng(xy([Selection_x1, (Selection_y1 + 60)]))
			.setContent(text1)
			.openOn(featureGroup_Legend);
	}

function changeFontSizeForClass(CssClassName, TargetFontSize) {
	const elements = document.querySelectorAll(`.${CssClassName}`);
	elements.forEach(el => {
		el.style.fontSize = TargetFontSize;
		});
	}

</script>
<script>
var map = L.map('map', {
	crs: L.CRS.Simple,
	minZoom: -5,
	maxZoom: 3,
	maxBoundsViscosity: 0.1,
	zoomControl: false, // i have it after attribution
	inertia: false,
	inertiaMaxSpeed: 1000,
	zoomAnimation: false,
	fadeAnimation: false,
	});
map.getRenderer(map).options.padding = 100; // How much to extend the clip area around the map view (relative to its size) e.g. 0.1 would be 10% of map view in each direction

let SearchMarker = L.marker()
const Select_Ignore_interactive_map_Rectangle = L.rectangle([[-10000000, -10000000],[10000000, 10000000]], {color: "gray", weight: 0, fillOpacity: 0, interactive: true});
let Influence_Rectangle_MouseOver
let Enabled_LayerOverlay_InfluenceMouseOver = false
let Enabled_LayerOverlay_TextFlagSize = false
let Show_only_account_id = 0
let marker_first = L.marker([0,0])
let marker_second = L.marker([0,0])
let rectangle_from_markers

//<!-- Pulsing Marker -->
var cssIcon = L.divIcon({
	className: 'css-icon',
	html: '<div class="gps_ring"></div>'
	// Set marker width and height
	,iconSize: [22,22]
	// ,iconAnchor: [11,11]
	});
//<!-- Pulsing Marker -->

//<!-- xy to yx to L.latLng -->
var yx = L.latLng;
var xy = function(x, y) {
	if (Array.isArray(x)) {    // When doing xy([x, y]);
		return yx(x[1], x[0]);
		}
	return yx(y, x);  // When doing xy(x, y);
	};
//<!-- xy to yx to L.latLng -->

//<!--https://github.com/ablakey/Leaflet.SimpleGraticule --> 
var SimpleGraticuleOptions = {
	interval: 20,
	showOriginLabel: true,
	redraw: 'move',
	zoomIntervals: [
		{start: -5, end: -4, interval: 2048},
		{start: -3, end: -3, interval: 1024},
		{start: -2, end: -2, interval: 512},
		{start: -1, end: -1, interval: 256},
		{start: 0, end: 1, interval: 128},
		{start: 2, end: 3, interval: 64}
		]
	};
L.simpleGraticule(SimpleGraticuleOptions).addTo(map);
//<!-- https://github.com/ablakey/Leaflet.SimpleGraticule --> 
map.setMaxBounds([[-55102,-55102], [55102,55102]]);
const autocomplete_all_flag_ids = ["1","2","3","4","5","9","10","12","13","14","15","18","19","23","25","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","79","80","81","82","83","84","103","108","109","111","113","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","172","173","174","175","186","187","188","189","190","191","192","193","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","253","254","255","256","257","258","259","260","261","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499","500","501","502","503","504","505","506","507","508","509","510","511","512","513","514","515","516","517","518","519","520","521","522","523","524","525","526","527","528","529","530","531","532","533","534","535","536","537","538","539","540","541","549","550","551","552","553","554","555","556","557","558","559","560","561","562","563","564","565","566","567","568","569","570","571","572","573","574","575","576","577","578","579","580","585","586","588","589","590","591","592","593","594","595","596","597","598","599","600","601","602","603","604","605","606","607","609","610","611",] 
const ACCOUNT_NAME = ["","Sigrid Sigrúnarsdóttir","Game","Foreclosure","Helsengaard treasury","Meloun","L","Romer","Syksy","Rucknium","Avatar I","Avatar II grey","Avatar III fat","PotR","PotR jr","Avatar test","badjabber","A16","TFQuests","Avatar 4","Avatar V","Avatar 6","Avatar 7","Avatar 11","avatar 8","yaoxi","Island treasury","Avatar 12","Avatar 13","preland","Pauleheister","jdawg420","redcathode","jdawg42","njkdcskjnds sdfsdf dffse errerw treasury","ABC123 treasury","Happy Cook","Town treasury","avatar 9999","ammortel","SyksyII","Privacy",]
const ACCOUNT_HOUSE = ["","Sigrid Sigrúnarsdóttir","Game","Foreclosure","Helsengaard treasury","Meloun","L","Romer","Syksy","Rucknium","Avatar I","Avatar II grey","Avatar III fat","PotR","PotR jr","Avatar test","badjabber","A16","TFQuests","Avatar 4","Avatar V","Avatar 6","Avatar 7","Avatar 11","avatar 8","yaoxi","Island treasury","Avatar 12","Avatar 13","preland","Pauleheister","jdawg420","redcathode","jdawg42","njkdcskjnds sdfsdf dffse errerw treasury","ABC123 treasury","Happy Cook","Town treasury","avatar 9999","ammortel","SyksyII","Privacy",]
const CITY_NAME = ["Helsengaard","Island","njkdcskjnds sdfsdf dffse errerw","ABC123","Town",]
const FLAG_ROLE_NAME = ["","agricultural","craft","industrial","commercial","basic residential","affluent residential","luxury residential","military","cultural","stonecutter","sawmill","kiln","smelter","workforce","road","research","fishery",]
const autocomplete_all_flag_names = ["Helsengaard town square","Tower","North Road","farm","Agricultural Field","Chop Chop on the Beach","East Street I","Cityside Gardens","Fishing Pier","Cityside Longhaus","Hare house","Icecrack Shack","Ugly Field","North side road","Syyskuunian Crafts","Western Road I","Helsengaard Park","Syysstad Imports & Exports","South-East Alleyway","East Street II","House by the Sea","Nice field","Big House","Work Bunks","Downtown Pad","Seaside Road II","Seaside Road I","Boat Builders","Seaside Road III","Syyskuunian Docks","Oats are good for you","Cow Paradise","Bad sawmill","Weird Table","Island town square","cfgvbbbbbbbvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv","House 2","house2","ORTERSCX\"\"SMCKW''sdkwo,,..fse","AASD``4564156","Syysstad Embassy","Syystadt Embassy Gardens","Tuorla, Helsengaard Observatory","njkdcskjnds sdfsdf dffse errerw town square","ABC123 town square","dfg","sdf","retert","fdgdfg","dsfsd","sdfsfd","erterter","dgfg","sdfsdf","aweawed","sdfsdfsdf","fdgdgf","ztutzutz","fgfg","59549459","59595959595959","Town town square","BIG HOUSE","pauleheister agricultur","pauleheister craft","Mia campagna","pauleheister saw","pauleheister basic residental","SyksyII's meager Helsengaard townhouse","SyksyII's meager Helsengaardian gardens","Highly Prestigious Southern Road","pauleheister stone","pauleheister commercial","pauleheister fish","pauleheister workforce","pauleheister affresi","y'y\"y`y%y^y$y#y@y//y/*y*/y-->y","Mega awesome residential","pauleheister commercial2","pauleheister research","pauleheister military","pauleheister culture","rode1",]

const BaseLayer_City0 = L.geoJson([]).addTo(map);
const Layer_Image_InactiveFlags_City0 = L.featureGroup([]).addTo(BaseLayer_City0);
const Layer_Image_RoleFlags_City0 = L.featureGroup([]);
const Layer_TextFlagSize_City0 = L.featureGroup([])
const Layer_Flags_ColorByRole_City0 = L.geoJson(Flags_city0, {
		style: Style_Role,
		onEachFeature
	})
const Layer_Flags_ColorByRepair_City0 = L.geoJson(Flags_city0, {
		style: Style_Repair,
		onEachFeature
	})
const Layer_Flags_ColorByOwner_City0 = L.geoJson(Flags_city0, {
		style: Style_Owner,
		onEachFeature
	})
const Layer_Flags_ColorByEcoPow_City0 = L.geoJson(Flags_city0, {
		style: Style_Economic_Power,
		onEachFeature
	})


const BaseLayer_City1 = L.geoJson([])
const Layer_Image_InactiveFlags_City1 = L.featureGroup([]).addTo(BaseLayer_City1);
const Layer_Image_RoleFlags_City1 = L.featureGroup([]);
const Layer_TextFlagSize_City1 = L.featureGroup([])
const Layer_Flags_ColorByRole_City1 = L.geoJson(Flags_city1, {
		style: Style_Role,
		onEachFeature
	})
const Layer_Flags_ColorByRepair_City1 = L.geoJson(Flags_city1, {
		style: Style_Repair,
		onEachFeature
	})
const Layer_Flags_ColorByOwner_City1 = L.geoJson(Flags_city1, {
		style: Style_Owner,
		onEachFeature
	})
const Layer_Flags_ColorByEcoPow_City1 = L.geoJson(Flags_city1, {
		style: Style_Economic_Power,
		onEachFeature
	})


const BaseLayer_City2 = L.geoJson([])
const Layer_Image_InactiveFlags_City2 = L.featureGroup([]).addTo(BaseLayer_City2);
const Layer_Image_RoleFlags_City2 = L.featureGroup([]);
const Layer_TextFlagSize_City2 = L.featureGroup([])
const Layer_Flags_ColorByRole_City2 = L.geoJson(Flags_city2, {
		style: Style_Role,
		onEachFeature
	})
const Layer_Flags_ColorByRepair_City2 = L.geoJson(Flags_city2, {
		style: Style_Repair,
		onEachFeature
	})
const Layer_Flags_ColorByOwner_City2 = L.geoJson(Flags_city2, {
		style: Style_Owner,
		onEachFeature
	})
const Layer_Flags_ColorByEcoPow_City2 = L.geoJson(Flags_city2, {
		style: Style_Economic_Power,
		onEachFeature
	})


const BaseLayer_City3 = L.geoJson([])
const Layer_Image_InactiveFlags_City3 = L.featureGroup([]).addTo(BaseLayer_City3);
const Layer_Image_RoleFlags_City3 = L.featureGroup([]);
const Layer_TextFlagSize_City3 = L.featureGroup([])
const Layer_Flags_ColorByRole_City3 = L.geoJson(Flags_city3, {
		style: Style_Role,
		onEachFeature
	})
const Layer_Flags_ColorByRepair_City3 = L.geoJson(Flags_city3, {
		style: Style_Repair,
		onEachFeature
	})
const Layer_Flags_ColorByOwner_City3 = L.geoJson(Flags_city3, {
		style: Style_Owner,
		onEachFeature
	})
const Layer_Flags_ColorByEcoPow_City3 = L.geoJson(Flags_city3, {
		style: Style_Economic_Power,
		onEachFeature
	})


const BaseLayer_City4 = L.geoJson([])
const Layer_Image_InactiveFlags_City4 = L.featureGroup([]).addTo(BaseLayer_City4);
const Layer_Image_RoleFlags_City4 = L.featureGroup([]);
const Layer_TextFlagSize_City4 = L.featureGroup([])
const Layer_Flags_ColorByRole_City4 = L.geoJson(Flags_city4, {
		style: Style_Role,
		onEachFeature
	})
const Layer_Flags_ColorByRepair_City4 = L.geoJson(Flags_city4, {
		style: Style_Repair,
		onEachFeature
	})
const Layer_Flags_ColorByOwner_City4 = L.geoJson(Flags_city4, {
		style: Style_Owner,
		onEachFeature
	})
const Layer_Flags_ColorByEcoPow_City4 = L.geoJson(Flags_city4, {
		style: Style_Economic_Power,
		onEachFeature
	})

const LayerOverlay_Firefighting = L.featureGroup([]);
const LayerOverlay_TaxBreakPoints = L.featureGroup([]);
const LayerOverlay_RoleImages = L.featureGroup([]).addTo(map);
const featureGroup_role = L.featureGroup([]).addTo(map);
const featureGroup_repair = L.featureGroup([]);
const featureGroup_owner = L.featureGroup([]);
const featureGroup_EcoPow = L.featureGroup([]);
const featureGroup_Legend = L.featureGroup([]);
const LayerOverlay_InfluenceMouseOver = L.featureGroup([]);
const LayerOverlay_TextFlagSize = L.featureGroup([]);
featureGroup_role.on('add',(e)=>{if (map.hasLayer(featureGroup_Legend) == 0) {legend_role.addTo(map)}});
featureGroup_role.on('remove',(e)=>{legend_role.remove()});
featureGroup_repair.on('add',(e)=>{if (map.hasLayer(featureGroup_Legend) == 0) {legend_repair.addTo(map)}});
featureGroup_repair.on('remove',(e)=>{legend_repair.remove()});
featureGroup_owner.on('add',(e)=>{if (map.hasLayer(featureGroup_Legend) == 0) {legend_owner.addTo(map)}});
featureGroup_owner.on('remove',(e)=>{legend_owner.remove()});
featureGroup_EcoPow.on('add',(e)=>{if (map.hasLayer(featureGroup_Legend) == 0) {legend_EcoPow.addTo(map)}});
featureGroup_EcoPow.on('remove',(e)=>{legend_EcoPow.remove()});
LayerOverlay_InfluenceMouseOver.on('add',(e)=>{Enabled_LayerOverlay_InfluenceMouseOver = true});
LayerOverlay_InfluenceMouseOver.on('remove',(e)=>{Enabled_LayerOverlay_InfluenceMouseOver = false});
LayerOverlay_TextFlagSize.on('add',(e)=>{Enabled_LayerOverlay_TextFlagSize = true});
LayerOverlay_TextFlagSize.on('remove',(e)=>{Enabled_LayerOverlay_TextFlagSize = false});
const Layer_firefighting_city_0 = L.layerGroup([]).addTo(LayerOverlay_Firefighting);
const Layer_tax_break_points_city_0 = L.layerGroup([]).addTo(LayerOverlay_TaxBreakPoints);
BaseLayer_City0.on('add',(e)=>{
	Layer_firefighting_city_0.addTo(LayerOverlay_Firefighting);
	Layer_tax_break_points_city_0.addTo(LayerOverlay_TaxBreakPoints);
	Layer_Image_RoleFlags_City0.addTo(LayerOverlay_RoleImages);
	Layer_TextFlagSize_City0.addTo(LayerOverlay_TextFlagSize);
	BaseLayer_City0.bringToBack();
	});
BaseLayer_City0.on('remove',(e)=>{
	Layer_firefighting_city_0.removeFrom(LayerOverlay_Firefighting);
	Layer_tax_break_points_city_0.removeFrom(LayerOverlay_TaxBreakPoints);
	Layer_Image_RoleFlags_City0.removeFrom(LayerOverlay_RoleImages);
	Layer_TextFlagSize_City0.removeFrom(LayerOverlay_TextFlagSize);
	map.removeLayer(SearchMarker);
	});
featureGroup_role.on('add',(e)=>{Layer_Flags_ColorByRole_City0.addTo(BaseLayer_City0).bringToBack();});
Layer_Flags_ColorByRole_City0.addTo(BaseLayer_City0)
featureGroup_role.on('remove',(e)=>{Layer_Flags_ColorByRole_City0.removeFrom(BaseLayer_City0);});
featureGroup_repair.on('add',(e)=>{Layer_Flags_ColorByRepair_City0.addTo(BaseLayer_City0).bringToBack();});
featureGroup_repair.on('remove',(e)=>{Layer_Flags_ColorByRepair_City0.removeFrom(BaseLayer_City0);});
featureGroup_owner.on('add',(e)=>{Layer_Flags_ColorByOwner_City0.addTo(BaseLayer_City0).bringToBack();});
featureGroup_owner.on('remove',(e)=>{Layer_Flags_ColorByOwner_City0.removeFrom(BaseLayer_City0);});
featureGroup_EcoPow.on('add',(e)=>{Layer_Flags_ColorByEcoPow_City0.addTo(BaseLayer_City0).bringToBack();});
featureGroup_EcoPow.on('remove',(e)=>{Layer_Flags_ColorByEcoPow_City0.removeFrom(BaseLayer_City0);});
const Layer_firefighting_city_1 = L.layerGroup([]);
const Layer_tax_break_points_city_1 = L.layerGroup([]);
BaseLayer_City1.on('add',(e)=>{
	Layer_firefighting_city_1.addTo(LayerOverlay_Firefighting);
	Layer_tax_break_points_city_1.addTo(LayerOverlay_TaxBreakPoints);
	Layer_Image_RoleFlags_City1.addTo(LayerOverlay_RoleImages);
	Layer_TextFlagSize_City1.addTo(LayerOverlay_TextFlagSize);
	BaseLayer_City1.bringToBack();
	});
BaseLayer_City1.on('remove',(e)=>{
	Layer_firefighting_city_1.removeFrom(LayerOverlay_Firefighting);
	Layer_tax_break_points_city_1.removeFrom(LayerOverlay_TaxBreakPoints);
	Layer_Image_RoleFlags_City1.removeFrom(LayerOverlay_RoleImages);
	Layer_TextFlagSize_City1.removeFrom(LayerOverlay_TextFlagSize);
	map.removeLayer(SearchMarker);
	});
featureGroup_role.on('add',(e)=>{Layer_Flags_ColorByRole_City1.addTo(BaseLayer_City1).bringToBack();});
Layer_Flags_ColorByRole_City1.addTo(BaseLayer_City1)
featureGroup_role.on('remove',(e)=>{Layer_Flags_ColorByRole_City1.removeFrom(BaseLayer_City1);});
featureGroup_repair.on('add',(e)=>{Layer_Flags_ColorByRepair_City1.addTo(BaseLayer_City1).bringToBack();});
featureGroup_repair.on('remove',(e)=>{Layer_Flags_ColorByRepair_City1.removeFrom(BaseLayer_City1);});
featureGroup_owner.on('add',(e)=>{Layer_Flags_ColorByOwner_City1.addTo(BaseLayer_City1).bringToBack();});
featureGroup_owner.on('remove',(e)=>{Layer_Flags_ColorByOwner_City1.removeFrom(BaseLayer_City1);});
featureGroup_EcoPow.on('add',(e)=>{Layer_Flags_ColorByEcoPow_City1.addTo(BaseLayer_City1).bringToBack();});
featureGroup_EcoPow.on('remove',(e)=>{Layer_Flags_ColorByEcoPow_City1.removeFrom(BaseLayer_City1);});
const Layer_firefighting_city_2 = L.layerGroup([]);
const Layer_tax_break_points_city_2 = L.layerGroup([]);
BaseLayer_City2.on('add',(e)=>{
	Layer_firefighting_city_2.addTo(LayerOverlay_Firefighting);
	Layer_tax_break_points_city_2.addTo(LayerOverlay_TaxBreakPoints);
	Layer_Image_RoleFlags_City2.addTo(LayerOverlay_RoleImages);
	Layer_TextFlagSize_City2.addTo(LayerOverlay_TextFlagSize);
	BaseLayer_City2.bringToBack();
	});
BaseLayer_City2.on('remove',(e)=>{
	Layer_firefighting_city_2.removeFrom(LayerOverlay_Firefighting);
	Layer_tax_break_points_city_2.removeFrom(LayerOverlay_TaxBreakPoints);
	Layer_Image_RoleFlags_City2.removeFrom(LayerOverlay_RoleImages);
	Layer_TextFlagSize_City2.removeFrom(LayerOverlay_TextFlagSize);
	map.removeLayer(SearchMarker);
	});
featureGroup_role.on('add',(e)=>{Layer_Flags_ColorByRole_City2.addTo(BaseLayer_City2).bringToBack();});
Layer_Flags_ColorByRole_City2.addTo(BaseLayer_City2)
featureGroup_role.on('remove',(e)=>{Layer_Flags_ColorByRole_City2.removeFrom(BaseLayer_City2);});
featureGroup_repair.on('add',(e)=>{Layer_Flags_ColorByRepair_City2.addTo(BaseLayer_City2).bringToBack();});
featureGroup_repair.on('remove',(e)=>{Layer_Flags_ColorByRepair_City2.removeFrom(BaseLayer_City2);});
featureGroup_owner.on('add',(e)=>{Layer_Flags_ColorByOwner_City2.addTo(BaseLayer_City2).bringToBack();});
featureGroup_owner.on('remove',(e)=>{Layer_Flags_ColorByOwner_City2.removeFrom(BaseLayer_City2);});
featureGroup_EcoPow.on('add',(e)=>{Layer_Flags_ColorByEcoPow_City2.addTo(BaseLayer_City2).bringToBack();});
featureGroup_EcoPow.on('remove',(e)=>{Layer_Flags_ColorByEcoPow_City2.removeFrom(BaseLayer_City2);});
const Layer_firefighting_city_3 = L.layerGroup([]);
const Layer_tax_break_points_city_3 = L.layerGroup([]);
BaseLayer_City3.on('add',(e)=>{
	Layer_firefighting_city_3.addTo(LayerOverlay_Firefighting);
	Layer_tax_break_points_city_3.addTo(LayerOverlay_TaxBreakPoints);
	Layer_Image_RoleFlags_City3.addTo(LayerOverlay_RoleImages);
	Layer_TextFlagSize_City3.addTo(LayerOverlay_TextFlagSize);
	BaseLayer_City3.bringToBack();
	});
BaseLayer_City3.on('remove',(e)=>{
	Layer_firefighting_city_3.removeFrom(LayerOverlay_Firefighting);
	Layer_tax_break_points_city_3.removeFrom(LayerOverlay_TaxBreakPoints);
	Layer_Image_RoleFlags_City3.removeFrom(LayerOverlay_RoleImages);
	Layer_TextFlagSize_City3.removeFrom(LayerOverlay_TextFlagSize);
	map.removeLayer(SearchMarker);
	});
featureGroup_role.on('add',(e)=>{Layer_Flags_ColorByRole_City3.addTo(BaseLayer_City3).bringToBack();});
Layer_Flags_ColorByRole_City3.addTo(BaseLayer_City3)
featureGroup_role.on('remove',(e)=>{Layer_Flags_ColorByRole_City3.removeFrom(BaseLayer_City3);});
featureGroup_repair.on('add',(e)=>{Layer_Flags_ColorByRepair_City3.addTo(BaseLayer_City3).bringToBack();});
featureGroup_repair.on('remove',(e)=>{Layer_Flags_ColorByRepair_City3.removeFrom(BaseLayer_City3);});
featureGroup_owner.on('add',(e)=>{Layer_Flags_ColorByOwner_City3.addTo(BaseLayer_City3).bringToBack();});
featureGroup_owner.on('remove',(e)=>{Layer_Flags_ColorByOwner_City3.removeFrom(BaseLayer_City3);});
featureGroup_EcoPow.on('add',(e)=>{Layer_Flags_ColorByEcoPow_City3.addTo(BaseLayer_City3).bringToBack();});
featureGroup_EcoPow.on('remove',(e)=>{Layer_Flags_ColorByEcoPow_City3.removeFrom(BaseLayer_City3);});
const Layer_firefighting_city_4 = L.layerGroup([]);
const Layer_tax_break_points_city_4 = L.layerGroup([]);
BaseLayer_City4.on('add',(e)=>{
	Layer_firefighting_city_4.addTo(LayerOverlay_Firefighting);
	Layer_tax_break_points_city_4.addTo(LayerOverlay_TaxBreakPoints);
	Layer_Image_RoleFlags_City4.addTo(LayerOverlay_RoleImages);
	Layer_TextFlagSize_City4.addTo(LayerOverlay_TextFlagSize);
	BaseLayer_City4.bringToBack();
	});
BaseLayer_City4.on('remove',(e)=>{
	Layer_firefighting_city_4.removeFrom(LayerOverlay_Firefighting);
	Layer_tax_break_points_city_4.removeFrom(LayerOverlay_TaxBreakPoints);
	Layer_Image_RoleFlags_City4.removeFrom(LayerOverlay_RoleImages);
	Layer_TextFlagSize_City4.removeFrom(LayerOverlay_TextFlagSize);
	map.removeLayer(SearchMarker);
	});
featureGroup_role.on('add',(e)=>{Layer_Flags_ColorByRole_City4.addTo(BaseLayer_City4).bringToBack();});
Layer_Flags_ColorByRole_City4.addTo(BaseLayer_City4)
featureGroup_role.on('remove',(e)=>{Layer_Flags_ColorByRole_City4.removeFrom(BaseLayer_City4);});
featureGroup_repair.on('add',(e)=>{Layer_Flags_ColorByRepair_City4.addTo(BaseLayer_City4).bringToBack();});
featureGroup_repair.on('remove',(e)=>{Layer_Flags_ColorByRepair_City4.removeFrom(BaseLayer_City4);});
featureGroup_owner.on('add',(e)=>{Layer_Flags_ColorByOwner_City4.addTo(BaseLayer_City4).bringToBack();});
featureGroup_owner.on('remove',(e)=>{Layer_Flags_ColorByOwner_City4.removeFrom(BaseLayer_City4);});
featureGroup_EcoPow.on('add',(e)=>{Layer_Flags_ColorByEcoPow_City4.addTo(BaseLayer_City4).bringToBack();});
featureGroup_EcoPow.on('remove',(e)=>{Layer_Flags_ColorByEcoPow_City4.removeFrom(BaseLayer_City4);});
const allFlagsCities = [  Flags_city0, Flags_city1, Flags_city2, Flags_city3, Flags_city4,];
const Img_role = []
	Img_role[0] = './dist/inactive.svg'
	Img_role[1] = './dist/farm.svg'
	Img_role[2] = './dist/anvil.svg'
	Img_role[3] = ''
	Img_role[4] = './dist/shop.svg'
	Img_role[5] = './dist/tent.svg'
	Img_role[6] = './dist/longhouse.svg'
	Img_role[7] = './dist/castle.svg'
	Img_role[8] = './dist/sword.svg'
	Img_role[9] = './dist/beer.svg'
	Img_role[10] = './dist/stone.svg'
	Img_role[11] = './dist/tree.svg'
	Img_role[13] = ''
	Img_role[14] = './dist/slave.svg'
	Img_role[15] = ''
	Img_role[16] = './dist/research.svg'
	Img_role[17] = './dist/ship.svg'
const ti_city = [];
	ti_city[0] = Layer_Image_InactiveFlags_City0
	ti_city[1] = Layer_Image_InactiveFlags_City1
	ti_city[2] = Layer_Image_InactiveFlags_City2
	ti_city[3] = Layer_Image_InactiveFlags_City3
	ti_city[4] = Layer_Image_InactiveFlags_City4
const Generation_of_inactive_images = L.geoJson(allFlagsCities, {
		onEachFeature: function(feature, layer){
			if ( feature.properties.active == 'false' && feature.properties.role != 0 ) {
				L.imageOverlay(Img_role[0], [xy(feature.geometry.coordinates[0][0]),xy(feature.geometry.coordinates[0][2])]).addTo(ti_city[feature.properties.city])
	}}})
const t_city = [];
	t_city[0] = Layer_Image_RoleFlags_City0
	t_city[1] = Layer_Image_RoleFlags_City1
	t_city[2] = Layer_Image_RoleFlags_City2
	t_city[3] = Layer_Image_RoleFlags_City3
	t_city[4] = Layer_Image_RoleFlags_City4
const Generation_of_role_images = L.geoJson(allFlagsCities, {
		onEachFeature: function(feature, layer){
			if ( feature.properties.active == 'true' && Img_role[feature.properties.role] != '' ) {
				L.imageOverlay(Img_role[feature.properties.role], [xy(feature.geometry.coordinates[0][0]),xy(feature.geometry.coordinates[0][2])]).addTo(t_city[feature.properties.city])
	}}})
const ts_city = [];
	ts_city[0] = Layer_TextFlagSize_City0
	ts_city[1] = Layer_TextFlagSize_City1
	ts_city[2] = Layer_TextFlagSize_City2
	ts_city[3] = Layer_TextFlagSize_City3
	ts_city[4] = Layer_TextFlagSize_City4
const Generation_of_flag_sizes = L.geoJson(allFlagsCities, {
		onEachFeature: function(feature, layer){
				const x_size = (feature.geometry.coordinates[0][2][0] - feature.geometry.coordinates[0][0][0] + 1)
				const y_size = (feature.geometry.coordinates[0][2][1] - feature.geometry.coordinates[0][0][1] + 1)
				const horizontal_position 	=	xy([	(feature.geometry.coordinates[0][0][0] + (x_size / 2)),	(feature.geometry.coordinates[0][0][1] + (y_size / 5))	])
				const vertical_position		=	xy([	(feature.geometry.coordinates[0][0][0] + (x_size / 5)),	(feature.geometry.coordinates[0][0][1] + (y_size / 2))	])
				
				L.marker(horizontal_position,	{icon: L.divIcon({className: 'Flag_size_x',html: x_size}),zIndexOffset: 1000, interactive: false}).addTo(ts_city[feature.properties.city])
				L.marker(vertical_position,		{icon: L.divIcon({className: 'Flag_size_y',html: y_size}),zIndexOffset: 1000, interactive: false}).addTo(ts_city[feature.properties.city])
	}})
map.on('zoomend', function () {
	if (Enabled_LayerOverlay_TextFlagSize == true) {
		var zoomLevel = map.getZoom();
		console.log('Zoom: ' + zoomLevel)
		switch (zoomLevel) {
			case -5:
				changeFontSizeForClass('Flag_size_x', '0px');
				changeFontSizeForClass('Flag_size_y', '0px');
				break;
			case -4:
				changeFontSizeForClass('Flag_size_x', '0px');
				changeFontSizeForClass('Flag_size_y', '0px');
				break;
			case -3:
				changeFontSizeForClass('Flag_size_x', '0px');
				changeFontSizeForClass('Flag_size_y', '0px');
				break;
			case -2:
				changeFontSizeForClass('Flag_size_x', '8px');
				changeFontSizeForClass('Flag_size_y', '8px');
				break;
			case -1:
				changeFontSizeForClass('Flag_size_x', '10px');
				changeFontSizeForClass('Flag_size_y', '10px');
				break;
			case 0:
				changeFontSizeForClass('Flag_size_x', '16px');
				changeFontSizeForClass('Flag_size_y', '16px');
				break;
			case 1:
				changeFontSizeForClass('Flag_size_x', '16px');
				changeFontSizeForClass('Flag_size_y', '16px');
				break;
			case 2:
				changeFontSizeForClass('Flag_size_x', '16px');
				changeFontSizeForClass('Flag_size_y', '16px');
				break;
			case 3:
				changeFontSizeForClass('Flag_size_x', '18px');
				changeFontSizeForClass('Flag_size_y', '18px');
				break;
			default:
				changeFontSizeForClass('Flag_size_x', '10px');
				changeFontSizeForClass('Flag_size_y', '10px');
			}
		}
	});

L.rectangle([xy([-1115, -2008]),xy([1459, 581])], {color: 'DarkSlateGray',fillColor: 'LightGreen', weight: 3, fillOpacity: 0.5, interactive: false}).addTo(Layer_firefighting_city_0);
L.rectangle([xy([72, -50]),xy([507, 387])], {color: 'DarkSlateGray',fillColor: 'LightGreen', weight: 3, fillOpacity: 0.5, interactive: false}).addTo(Layer_firefighting_city_0);
L.rectangle([xy([-2772, -2278]),xy([2294, 2795])], {color: 'DarkSlateGray',fillColor: 'LightGreen', weight: 3, fillOpacity: 0.5, interactive: false}).addTo(Layer_firefighting_city_1);
L.rectangle([xy([-5275, -3407]),xy([5425, 7279])], {color: 'DarkSlateGray',fillColor: 'LightGreen', weight: 3, fillOpacity: 0.5, interactive: false}).addTo(Layer_firefighting_city_0);

L.marker(xy([0, 0])).addTo(Layer_tax_break_points_city_0);
L.marker(xy([0, 0]), {icon: cssIcon}).addTo(Layer_tax_break_points_city_0);
L.marker(xy([0, 0])).addTo(Layer_tax_break_points_city_1);
L.marker(xy([0, 0]), {icon: cssIcon}).addTo(Layer_tax_break_points_city_1);
L.marker(xy([24962, 16852])).addTo(Layer_tax_break_points_city_1);
L.marker(xy([24962, 16852]), {icon: cssIcon}).addTo(Layer_tax_break_points_city_1);
L.marker(xy([3460, 449])).addTo(Layer_tax_break_points_city_1);
L.marker(xy([3460, 449]), {icon: cssIcon}).addTo(Layer_tax_break_points_city_1);
L.marker(xy([0, 0])).addTo(Layer_tax_break_points_city_2);
L.marker(xy([0, 0]), {icon: cssIcon}).addTo(Layer_tax_break_points_city_2);
L.marker(xy([0, 0])).addTo(Layer_tax_break_points_city_3);
L.marker(xy([0, 0]), {icon: cssIcon}).addTo(Layer_tax_break_points_city_3);
L.marker(xy([0, 0])).addTo(Layer_tax_break_points_city_4);
L.marker(xy([0, 0]), {icon: cssIcon}).addTo(Layer_tax_break_points_city_4);
L.rectangle([xy([-7776, -6265]),xy([11447, 14509])], {color: 'Orange',fill: false, weight: 10}).bindPopup('No Flag is beyond this line').addTo(BaseLayer_City0);
L.rectangle([xy([-11783, -3748]),xy([51102, 17889])], {color: 'Orange',fill: false, weight: 10}).bindPopup('No Flag is beyond this line').addTo(BaseLayer_City1);
L.rectangle([xy([-1128, -1128]),xy([1127, 1127])], {color: 'Orange',fill: false, weight: 10}).bindPopup('No Flag is beyond this line').addTo(BaseLayer_City2);
L.rectangle([xy([-1128, -1128]),xy([1127, 1127])], {color: 'Orange',fill: false, weight: 10}).bindPopup('No Flag is beyond this line').addTo(BaseLayer_City3);
L.rectangle([xy([-1128, -1152]),xy([1398, 1127])], {color: 'Orange',fill: false, weight: 10}).bindPopup('No Flag is beyond this line').addTo(BaseLayer_City4);
//<!-- Info panel top right -->>
const info = L.control();

info.onAdd = function (map) {
		this._div = L.DomUtil.create('div', 'info');
		this.update();
		return this._div;
	};

info.update = function (f) {
		const contents = f ? `<table><tr><td align='right'><u>Flag ID</u></td></tr><tr><td align='right'> ${f.id}</td></tr><tr><td align='right'><u>Owner</u></td></tr><tr><td align='right'>${ACCOUNT_NAME[f.properties.owner]}</td></tr><tr><td align='right'><u>Flag Name</td></u></tr><tr><td align='right'>${f.properties.name}</td></tr></table>` : 'Hover over a Flag';
		this._div.innerHTML = `<h4 align='right'>Flag Info</h4>${contents}`;
	};

info.addTo(map);
//<!-- Info panel top right -->>
map.attributionControl.setPosition('bottomleft')
map.attributionControl.setPrefix('<a href="https://www.townforge.net/">Townforge</a> | <abbr title="0.36.6.4-release |  Generated at 2025/08/23_01:08 UTC / Blockchain height: 1,374,850 | Update should be each game tick"><abbr id="timer">Loading...</abbr></abbr>')
const Generated_time_string = "2025/08/23_01:08"// attribution tick timer
const target = parseDate(Generated_time_string);// attribution tick timer
const timerEl = document.getElementById('timer');// attribution tick timer
update_tick_timer();// attribution tick timer
setInterval(update_tick_timer, 1000);// attribution tick timer
L.control.zoom({position:'bottomleft'}).addTo(map)
const legend_repair_text="<div style=\"background-color:Chartreuse\" class=\"Legend_text_background_repair\">> 70%</div>   <br class='Legend_br_height'><div style=\"background-color:LightSalmon\" class=\"Legend_text_background_repair\">> 60%</div>  <br class='Legend_br_height'><div style=\"background-color:Coral\" class=\"Legend_text_background_repair\">> 50%</div>        <br class='Legend_br_height'><div style=\"background-color:Tomato\" class=\"Legend_text_background_repair\">> 40%</div>       <br class='Legend_br_height'><div style=\"background-color:OrangeRed\" class=\"Legend_text_background_repair\">> 30%</div>    <br class='Legend_br_height'><div style=\"background-color:MediumPurple\" class=\"Legend_text_background_repair\">> 20%</div> <br class='Legend_br_height'><div style=\"background-color:RebeccaPurple\" class=\"Legend_text_background_repair\">> 00%</div><br class='Legend_br_height'><div style=\"background-color:white\" class=\"Legend_text_background_repair\">= 00%</div>        "                                                                                    
const legend_repair = L.control({position: 'bottomright'});                          
legend_repair.onAdd = function (map) {
	const div = L.DomUtil.create('div', 'info legend');
	
	div.innerHTML = legend_repair_text;
	return div;
	};

const legend_role_text="<div style=\"background-color:    white \" class=\"Legend_text_background_role\">none                </div><br class='Legend_br_height'><div style=\"background-color:LawnGreen \" class=\"Legend_text_background_role\">agricultural        </div><br class='Legend_br_height'><div style=\"background-color:Cyan \" class=\"Legend_text_background_role\">craft               </div><br class='Legend_br_height'><div style=\"background-color:SaddleBrown \" class=\"Legend_text_background_role\">industrial          </div><br class='Legend_br_height'><div style=\"background-color:Magenta \" class=\"Legend_text_background_role\">commercial          </div><br class='Legend_br_height'><div style=\"background-color:Orange \" class=\"Legend_text_background_role\">basic residential   </div><br class='Legend_br_height'><div style=\"background-color:DarkOrange \" class=\"Legend_text_background_role\">affluent residential</div><br class='Legend_br_height'><div style=\"background-color:OrangeRed \" class=\"Legend_text_background_role\">luxury residential  </div><br class='Legend_br_height'><div style=\"background-color:DarkSlateGray \" class=\"Legend_text_background_role\">military            </div><br class='Legend_br_height'><div style=\"background-color:MediumSlateBlue \" class=\"Legend_text_background_role\">cultural            </div><br class='Legend_br_height'><div style=\"background-color:Silver\" class=\"Legend_text_background_role\">stonecutter         </div><br class='Legend_br_height'><div style=\"background-color:ForestGreen\" class=\"Legend_text_background_role\">sawmill             </div><br class='Legend_br_height'><div style=\"background-color:SandyBrown\" class=\"Legend_text_background_role\">kiln                </div><br class='Legend_br_height'><div style=\"background-color:Tan\" class=\"Legend_text_background_role\">smelter             </div><br class='Legend_br_height'><div style=\"background-color:NavajoWhite\" class=\"Legend_text_background_role\">workforce           </div><br class='Legend_br_height'><div style=\"background-color:DimGray\" class=\"Legend_text_background_role\">road                </div><br class='Legend_br_height'><div style=\"background-color:RebeccaPurple\" class=\"Legend_text_background_role\">research            </div><br class='Legend_br_height'><div style=\"background-color:RoyalBlue\" class=\"Legend_text_background_role\">fishery             </div>"

const legend_role = L.control({position: 'bottomright'});
legend_role.onAdd = function (map) {
	const div = L.DomUtil.create('div', 'info legend');
	div.innerHTML = legend_role_text;
	return div;
	};       
//default view
legend_role.addTo(map);
        
const legend_owner_text="Colors are generated from house name"

const legend_owner = L.control({position: 'bottomright'});
legend_owner.onAdd = function (map) {
	const div = L.DomUtil.create('div', 'info legend');
	div.innerHTML = legend_owner_text;
	return div;
	};

const legend_EcoPow_text="<div style=\"background-color:#0AF51A\" class=\"Legend_text_background_Economic_Power\">= 300%</div><br class='Legend_br_height'><div style=\"background-color:#23AC1F\" class=\"Legend_text_background_Economic_Power\">> 250%</div><br class='Legend_br_height'><div style=\"background-color:#22681B\" class=\"Legend_text_background_Economic_Power\">> 200%</div><br class='Legend_br_height'><div style=\"background-color:#F58F0A\" class=\"Legend_text_background_Economic_Power\">> 150%</div><br class='Legend_br_height'><div style=\"background-color:#AD6614\" class=\"Legend_text_background_Economic_Power\">> 100%</div><br class='Legend_br_height'><div style=\"background-color:#694014\" class=\"Legend_text_background_Economic_Power\">= 100%</div>"
const legend_EcoPow = L.control({position: 'bottomright'});
legend_EcoPow.onAdd = function (map) {
	const div = L.DomUtil.create('div', 'info legend');
	div.innerHTML = legend_EcoPow_text;
	return div;
	};

const legend_Influence_calculator_text="<b>Influence Calculator</b><ol><li><button id='InfluenceButton1' onclick='function_select_first_marker()'>Select first corner</button><li><button id='InfluenceButton2' onclick='function_select_second_marker()'>Select second corner</button><li><button id='InfluenceButton3' onclick='function_get_selection_influence()'>Calculate influence</button></ol>"
const legend_Influence_calculator = L.control({position: 'bottomright'});
legend_Influence_calculator.onAdd = function (map) {
	const div = L.DomUtil.create('div', 'info legend');
	div.innerHTML = legend_Influence_calculator_text;
	return div;
	};

var baseMaps = {
	'Helsengaard': BaseLayer_City0,
	'Island': BaseLayer_City1,
	'njkdcskjnds sdfsdf dffse errerw': BaseLayer_City2,
	'ABC123': BaseLayer_City3,
	'Town': BaseLayer_City4,
	};
var baseMaps_overlays = {
	'Firefighting range': LayerOverlay_Firefighting,
	'Tax break points': LayerOverlay_TaxBreakPoints,
	'Role images': LayerOverlay_RoleImages,
	'Flag influence': LayerOverlay_InfluenceMouseOver,
	'Flag size': LayerOverlay_TextFlagSize,
	};
var overlays = {
	'Role': featureGroup_role,
	'Repair': featureGroup_repair,
	'Owner': featureGroup_owner,
	'E.Power': featureGroup_EcoPow,
	};
var overlays_overlays = {};
var layerControl = L.control.layers(baseMaps,baseMaps_overlays,{ collapsed:false, position:'topleft' }).addTo(map);
var layerControl = L.control.layers(overlays,overlays_overlays,{ collapsed:false, position:'topleft' }).addTo(map);
const Burger_Search_popup = L.popup({maxWidth: 1000, className: 'popup_without_tip', autoClose: true, closeOnClick: false}).setLatLng(xy([0, 0]))
L.control.burgerMenu({
	title: "Search Menu",
	menuIcon: "<img src='./dist/search.svg' style='width:20px;'>" ,
	menuItems: [
		{title: "Search Flag ID", onClick: () => { 
			Burger_Search_popup.setContent("					<!--Make sure the form has the autocomplete function switched off:-->					<form id='search_form_1' autocomplete='off' >					<div class='autocomplete' style='min-width:300px;width:100%'>					<b>Flag ID:</b> <input onclick='runAutocomplete_flag_id()' id='myInput1' type='text' placeholder='1'>					</div></form>					<button  onclick='Search_Button_1()'>Search</button>					<p id='search_form_result1'></p>					<button  onclick='GoToFlag_Button_1()' disabled='true' id='button01'>Go To Flag</button>					")
				.openOn(map);
			map.setView( [0, 0]);},
			},
		{title: "Search Flag Name", onClick: () => { 
			Burger_Search_popup.setContent("					<!--Make sure the form has the autocomplete function switched off:-->					<form id='search_form_2' autocomplete='off' >					<div class='autocomplete' style='min-width:300px;width:100%'>					<b>Flag name:</b> <input onclick='runAutocomplete_flag_names()' id='myInput2' type='text' placeholder='Helsengaard town square'>					</div></form>					<button  onclick='Search_Button_2()'>Search</button>					<p id='search_form_result2'></p>					<button  onclick='GoToFlag_Button_2()' disabled='true' id='button02'>Go To Flag</button>					")
				.openOn(map);
			map.setView( [0, 0]);},
			},
		{title: "Search Name", onClick: () => { 
			Burger_Search_popup.setContent("					<!--Make sure the form has the autocomplete function switched off:-->					<form id='search_form_3' autocomplete='off' >					<div class='autocomplete' style='min-width:300px;width:100%'>					<b>Descendant name:</b> <input onclick='runAutocomplete_account_names()' id='myInput3' type='text' placeholder='Sigrid Sigrúnarsdóttir'>					</div>					</form>					<button  onclick='Search_Button_3()'>Search</button>					<p id='search_form_result3'></p>					<button  onclick='Show_only_account_id_3()' disabled='true' id='button03'>Highlight these flags</button>					")
				.openOn(map);
			map.setView( [0, 0]);},
			},
		{title: "Search House", onClick: () => { 
			Burger_Search_popup.setContent("					<!--Make sure the form has the autocomplete function switched off:-->					<form id='search_form_4' autocomplete='off' >					<div class='autocomplete' style='min-width:300px;width:100%'>					<b>House name:</b> <input onclick='runAutocomplete_house_names()' id='myInput4' type='text' placeholder='Sigrún'>					</div>					</form>					<button  onclick='Search_Button_4()'>Search</button>					<p id='search_form_result4'></p>					<button  onclick='Show_only_account_id_4()' disabled='true' id='button04'>Highlight these flags</button>					")
				.openOn(map);
			map.setView( [0, 0]);},
			},
		],
	}).addTo(map);
const Burger_Leaderboard_popup = L.popup({maxWidth: 1000, className: 'popup_without_tip', autoClose: true, closeOnClick: false}).setLatLng(xy([0, 0]))
const Burger_City_Info_popup = L.popup({maxWidth: 1000, className: 'popup_without_tip', autoClose: true, closeOnClick: false}).setLatLng(xy([0, 0]))
L.control.burgerMenu({
	title: "Info Menu",
	menuIcon: "<img src='./dist/info.svg' style='width:20px;'>" ,
	menuItems: [
		{title: "City info",
			menuItems: [
				{title: "Helsengaard",onClick: () => {Burger_City_Info_popup.setContent("<table class='popup_table'><tr><td>Name:</td><td><b>Helsengaard</b></td></tr><tr><td>ID:</td><td>0</td></tr><tr><td>Level (max):</td><td>6 (6)</td></tr><tr><td>Mayor</td><td>Sigrid Sigrúnarsdóttir</td></tr><tr><td>Citizens:</td><td>15</td></tr><tr><td>Flags:</td><td>469</td></tr><tr><td>Flags Inactive:</td><td>75</td></tr><tr><td>Flags Empty:</td><td>73</td></tr></table>").openOn(map);},},
				{title: "Island",onClick: () => {Burger_City_Info_popup.setContent("<table class='popup_table'><tr><td>Name:</td><td><b>Island</b></td></tr><tr><td>ID:</td><td>1</td></tr><tr><td>Level (max):</td><td>5 (5)</td></tr><tr><td>Mayor</td><td>Meloun</td></tr><tr><td>Citizens:</td><td>2</td></tr><tr><td>Flags:</td><td>33</td></tr><tr><td>Flags Inactive:</td><td>4</td></tr><tr><td>Flags Empty:</td><td>3</td></tr></table>").openOn(map);},},
				{title: "njkdcskjnds sdfsdf dffse errerw",onClick: () => {Burger_City_Info_popup.setContent("<table class='popup_table'><tr><td>Name:</td><td><b>njkdcskjnds sdfsdf dffse errerw</b></td></tr><tr><td>ID:</td><td>2</td></tr><tr><td>Level (max):</td><td>0 (0)</td></tr><tr><td>Mayor</td><td>Meloun</td></tr><tr><td>Citizens:</td><td>1</td></tr><tr><td>Flags:</td><td>1</td></tr><tr><td>Flags Inactive:</td><td>0</td></tr><tr><td>Flags Empty:</td><td>0</td></tr></table>").openOn(map);},},
				{title: "ABC123",onClick: () => {Burger_City_Info_popup.setContent("<table class='popup_table'><tr><td>Name:</td><td><b>ABC123</b></td></tr><tr><td>ID:</td><td>3</td></tr><tr><td>Level (max):</td><td>0 (0)</td></tr><tr><td>Mayor</td><td>Meloun</td></tr><tr><td>Citizens:</td><td>1</td></tr><tr><td>Flags:</td><td>1</td></tr><tr><td>Flags Inactive:</td><td>0</td></tr><tr><td>Flags Empty:</td><td>0</td></tr></table>").openOn(map);},},
				{title: "Town",onClick: () => {Burger_City_Info_popup.setContent("<table class='popup_table'><tr><td>Name:</td><td><b>Town</b></td></tr><tr><td>ID:</td><td>4</td></tr><tr><td>Level (max):</td><td>1 (1)</td></tr><tr><td>Mayor</td><td>Meloun</td></tr><tr><td>Citizens:</td><td>2</td></tr><tr><td>Flags:</td><td>2</td></tr><tr><td>Flags Inactive:</td><td>0</td></tr><tr><td>Flags Empty:</td><td>0</td></tr></table>").openOn(map);},},
			],
			},
		{title: "Leaderboards",
			menuItems: [
				{title: "Gold",
				menuItems: [
					{title: "Balance",onClick: () => {Burger_Leaderboard_popup.setContent(generateTable(Account_data, 0)).openOn(map);},},
					{title: "Demonetized coins",onClick: () => {Burger_Leaderboard_popup.setContent(generateTable(Account_data, 4)).openOn(map);},},
					{title: "Gold smelted",onClick: () => {Burger_Leaderboard_popup.setContent(generateTable(Account_data, 6)).openOn(map);},},
					{title: "Tax paid",onClick: () => {Burger_Leaderboard_popup.setContent(generateTable(Account_data, 17)).openOn(map);},},
					],},
				{title: "Food",
				menuItems: [
					{title: "Food consumed",onClick: () => {Burger_Leaderboard_popup.setContent(generateTable(Account_data, 5)).openOn(map);},},
					{title: "Grain harvested",onClick: () => {Burger_Leaderboard_popup.setContent(generateTable(Account_data, 7)).openOn(map);},},
					{title: "Vegetables harvested",onClick: () => {Burger_Leaderboard_popup.setContent(generateTable(Account_data, 18)).openOn(map);},},
					],},
				{title: "Food - Animals",
				menuItems: [
					{title: "Moose killed",onClick: () => {Burger_Leaderboard_popup.setContent(generateTable(Account_data, 1)).openOn(map);},},
					{title: "Bears killed",onClick: () => {Burger_Leaderboard_popup.setContent(generateTable(Account_data, 2)).openOn(map);},},
					{title: "Fish fished",onClick: () => {Burger_Leaderboard_popup.setContent(generateTable(Account_data, 3)).openOn(map);},},
					],},
				{title: "Other",
				menuItems: [
					{title: "Level",onClick: () => {Burger_Leaderboard_popup.setContent(generateTable(Account_data, 8)).openOn(map);},},
					{title: "Auctions created",onClick: () => {Burger_Leaderboard_popup.setContent(generateTable(Account_data, 9)).openOn(map);},},
					{title: "Buildings demolished",onClick: () => {Burger_Leaderboard_popup.setContent(generateTable(Account_data, 10)).openOn(map);},},
					{title: "Discoveries",onClick: () => {Burger_Leaderboard_popup.setContent(generateTable(Account_data, 11)).openOn(map);},},
					{title: "Fires put out",onClick: () => {Burger_Leaderboard_popup.setContent(generateTable(Account_data, 12)).openOn(map);},},
					{title: "Pearls found",onClick: () => {Burger_Leaderboard_popup.setContent(generateTable(Account_data, 13)).openOn(map);},},
					{title: "Trades",onClick: () => {Burger_Leaderboard_popup.setContent(generateTable(Account_data, 14)).openOn(map);},},
					{title: "POS Blocks found",onClick: () => {Burger_Leaderboard_popup.setContent(generateTable(Account_data, 15)).openOn(map);},},
					{title: "Prestige",onClick: () => {Burger_Leaderboard_popup.setContent(generateTable(Account_data, 16)).openOn(map);},},
					],},
				{title: "Sustained",
				menuItems: [
					{title: "Sustained blocks",onClick: () => {Burger_Leaderboard_popup.setContent(generateTable(Account_data, 19)).openOn(map);},},
					{title: "Sustained food",onClick: () => {Burger_Leaderboard_popup.setContent(generateTable(Account_data, 20)).openOn(map);},},
					{title: "Sustained gold",onClick: () => {Burger_Leaderboard_popup.setContent(generateTable(Account_data, 21)).openOn(map);},},
					],},
				],
			},
		],
	}).addTo(map);
map.setView( [0, 0], -1)
</script>
</body>
</html>
